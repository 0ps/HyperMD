/*!
 * HyperMD, copyright (c) by laobubu
 * Distributed under an MIT license: http://laobubu.net/HyperMD/LICENSE
 *
 * Break the Wall between writing and preview, in a Markdown Editor.
 *
 * HyperMD makes Markdown editor on web WYSIWYG, based on CodeMirror
 *
 * Homepage: http://laobubu.net/HyperMD/
 * Issues: https://github.com/laobubu/HyperMD/issues
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("codemirror"),require("codemirror/mode/markdown/markdown"),require("codemirror/addon/mode/overlay"),require("marked"),require("codemirror/mode/meta")):"function"==typeof define&&define.amd?define(["exports","codemirror","codemirror/mode/markdown/markdown","codemirror/addon/mode/overlay","marked","codemirror/mode/meta"],t):t(e.HyperMD={},e.CodeMirror,null,null,e.marked)}(this,function(e,s,t,n,i){"use strict";s=s&&s.hasOwnProperty("default")?s.default:s,i=i&&i.hasOwnProperty("default")?i.default:i;var c=function(e,t,n,i){void 0===n&&(n=!1),void 0===i&&(i="enabled"),this.on_cb=e,this.off_cb=t,this.state=n,this.subkey=i};function d(t,n,i){n=~~n||5;var r=250;setTimeout(function e(){if(n--){try{if(t())return}catch(e){}setTimeout(e,r),r*=2}else i&&i()},0)}function r(e,t){var n=null,i=0,r=function(){e(),n=0},o=function(){var e=+new Date;if(n){if(e<i)return;clearTimeout(n)}n=setTimeout(r,t),i=e+100};return o.stop=function(){n&&(clearTimeout(n),n=0)},o}function o(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var n=e.display.view,i=0;i<n.length;i++)if((t-=n[i].size)<0)return i}function w(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[o(e,t)];var n=e.display.externalMeasured;return n&&t>=n.lineN&&t<n.lineN+n.size?n:void 0}function D(e,t,n){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache,before:!1};for(var i=0;i<e.rest.length;i++)if(e.rest[i]==t)return{map:e.measure.maps[i],cache:e.measure.caches[i],before:!1};for(var r=0;r<e.rest.length;r++)if(e.rest[r].lineNo()>n)return{map:e.measure.maps[r],cache:e.measure.caches[r],before:!0}}c.prototype.set=function(e,t){var n="object"==typeof e&&e?e[this.subkey]:e;t&&(n=!!n),n!==this.state&&((this.state=n)?this.on_cb(n):this.off_cb(n))},c.prototype.setBool=function(e){return this.set(e,!0)};var a=Object.freeze({findViewIndex:o,findViewForLine:w,mapFromLineView:D});function y(e,t,n){var i,r=t.line,o={line:r,ch:0},a={line:r,ch:t.ch},l=new RegExp("(?:^|\\s)"+n+"(?:\\s|$)"),s=e.getLineTokens(r);for(i=0;i<s.length&&!(s[i].end>=t.ch);i++);if(i===s.length)return null;for(var c=i;c<s.length;c++){var d=s[c];if(!l.test(d.type))break;a.ch=d.end}for(c=i;0<=c;c--){d=s[c];if(!l.test(d.type)){o.ch=d.end;break}}return{from:o,to:a}}function u(e,t){if(!t)for(var n=0,i=e.display.view;n<i.length;n+=1){var r=i[n];r.measure&&(r.measure.cache={})}setTimeout(function(){e.display.input.showSelection(e.display.input.prepareSelection())},60)}function l(i,r,o){return function(e){if(e.hmd||(e.hmd={}),!e.hmd[i]){var t=new r(e);if(e.hmd[i]=t,o)for(var n in o)t[n]=o[n];return t}return e.hmd[i]}}function f(e,t){var n={};for(var i in t)n[i]=e.hasOwnProperty(i)?e[i]:t[i];return n}var h=Object.freeze({Addon:function(e){},Getter:l,migrateOption:f}),H=new RegExp("^[^\\"+'`\\[]()<>_*~$|^@:!#+"'.split("").join("\\")+"\\s]+"),M=/^\s*(?:[*\-+]|[0-9]+([.)]))\s+/,L=/^\s*\|?(?:\s*\:?\s*\-+\s*\:?\s*\|)*\s*\:?\s*\-+\s*\:?\s*\|?\s*$/,T=/^((?:(?:aaas?|about|acap|adiumxtra|af[ps]|aim|apt|attachment|aw|beshare|bitcoin|bolo|callto|cap|chrome(?:-extension)?|cid|coap|com-eventbrite-attendee|content|crid|cvs|data|dav|dict|dlna-(?:playcontainer|playsingle)|dns|doi|dtn|dvb|ed2k|facetime|feed|file|finger|fish|ftp|geo|gg|git|gizmoproject|go|gopher|gtalk|h323|hcp|https?|iax|icap|icon|im|imap|info|ipn|ipp|irc[6s]?|iris(?:\.beep|\.lwz|\.xpc|\.xpcs)?|itms|jar|javascript|jms|keyparc|lastfm|ldaps?|magnet|mailto|maps|market|message|mid|mms|ms-help|msnim|msrps?|mtqp|mumble|mupdate|mvn|news|nfs|nih?|nntp|notes|oid|opaquelocktoken|palm|paparazzi|platform|pop|pres|proxy|psyc|query|res(?:ource)?|rmi|rsync|rtmp|rtsp|secondlife|service|session|sftp|sgn|shttp|sieve|sips?|skype|sm[bs]|snmp|soap\.beeps?|soldat|spotify|ssh|steam|svn|tag|teamspeak|tel(?:net)?|tftp|things|thismessage|tip|tn3270|tv|udp|unreal|urn|ut2004|vemmi|ventrilo|view-source|webcal|wss?|wtai|wyciwyg|xcon(?:-userid)?|xfire|xmlrpc\.beeps?|xmpp|xri|ymsgr|z39\.50[rs]?):(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]|\([^\s()<>]*\))+(?:\([^\s()<>]*\)|[^\s`*!()\[\]{};:'".,<>?«»“”‘’]))/i,S=/^\.{0,2}\/[^\>\s]+/,_=[1,2,4,8],C={8:"hmd-escape ",256:"hmd-link ",512:"hmd-link-url ",768:"hmd-link-url hmd-link-url-s ",1024:"hmd-barelink ",1280:"hmd-barelink hmd-footref ",1536:"hmd-barelink hmd-footref hmd-footref-lead ",1792:"hmd-footnote line-HyperMD-footnote ",2048:"hmd-footnote-url ",2304:"url "};s.defineMode("hypermd",function(e,t){var n={startState:function(){return{atBeginning:!0,quoteLevel:0,nstyle:0,table:null,tableCol:0,tableRow:0,inside:0,listSpaceStack:[],prevLineIsEmpty:!1,extra:null}},copyState:function(e){return{atBeginning:e.atBeginning,quoteLevel:e.quoteLevel,nstyle:e.nstyle,table:e.table,tableCol:e.tableCol,tableRow:e.tableRow,inside:e.inside,listSpaceStack:e.listSpaceStack&&e.listSpaceStack.slice(),prevLineIsEmpty:e.prevLineIsEmpty,extra:e.extra}},blankLine:function(e){return e.atBeginning=!0,e.prevLineIsEmpty=!0,e.quoteLevel=0,e.listSpaceStack=[],e.table=null,e.tableCol=0,e.tableRow=0,e.nstyle=0,3===e.inside?"line-HyperMD-codeblock line-background-HyperMD-codeblock-bg":null},token:function(e,t){t.combineTokens=null;var n,i=e.pos;switch(t.inside){case 1:return 0!==i&&"\\"===e.string.charAt(i-1)||!e.match(t.extra)?(e.match(/^(?:[^\$\\]+|\\.)+/)||e.next(),"math math-"+t.extra.length):(t.inside=0,"formatting formatting-math formatting-math-end math math-"+t.extra.length);case 3:return t.combineTokens=!0,0===i&&e.match(/^```\s*$/)?(t.inside=0,"line-HyperMD-codeblock line-background-HyperMD-codeblock-bg line-HyperMD-codeblock-end"):(e.skipToEnd(),"line-HyperMD-codeblock line-background-HyperMD-codeblock-bg")}if(0===i){t.atBeginning=!0,t.table&&(t.tableCol=0,t.tableRow++,1===t.tableRow&&L.test(e.string)?t.inside=4:t.inside=null);var r=e.indentation();if(e.match(/^```/))return t.combineTokens=!0,t.inside=3,"line-HyperMD-codeblock line-background-HyperMD-codeblock-bg line-HyperMD-codeblock-begin";if(0===t.listSpaceStack.length&&4<=r)return e.skipToEnd(),"line-HyperMD-codeblock line-background-HyperMD-codeblock-indented-bg";if(/^(?:-{3,}|={3,})$/.test(e.string)&&!t.prevLineIsEmpty){var o="="==e.string.charAt(0)?1:2;return e.skipToEnd(),"formatting line-HyperMD-header-line line-HyperMD-header-line-"+o}if(t.prevLineIsEmpty=!1,e.match(/^\>\s*/)){for(var a=1;e.match(/^\s*\>\s*/);)a++;return"formatting formatting-quote formatting-quote-"+(t.quoteLevel=a)+" quote quote-"+a+" line-HyperMD-quote line-HyperMD-quote-"+a}if(t.quoteLevel)return e.next(),t.combineTokens=!0,"line-HyperMD-quote line-HyperMD-quote-"+t.quoteLevel;if(e.match(/^(#+)(?:\s|$)/))return t.combineTokens=!0,"line-HyperMD-header line-HyperMD-header-"+e.string.match(/^#+/)[0].length;if(0!==t.listSpaceStack.length||e.match(M,!1)){for(var l=0===t.listSpaceStack[0]?1:0;l<t.listSpaceStack.length;l++){if(!(0<r)){t.listSpaceStack.splice(l);break}r-=t.listSpaceStack[l]}0<r&&t.listSpaceStack.push(r),0===t.listSpaceStack.length&&t.listSpaceStack.push(0),t.inside=2,t.extra=0}}if(2===t.inside){var s=t.listSpaceStack.length,c=0===t.extra,d="";if(c&&0===t.listSpaceStack[0]){if(1===s)return t.inside=null,t.extra=null,t.combineTokens=!0,e.match(M)||e.next(),"line-HyperMD-list-line line-HyperMD-list-line-1";t.extra++,d+="hmd-list-indent-virtual "}for(var f=t.listSpaceStack[t.extra],u=!1;0<f;){var h=e.next();if("\t"===h)f-=4;else{if(" "!==h){t.inside=null,u=!(t.extra=null);break}f-=1}}return d+="hmd-list-indent hmd-list-indent-"+(t.extra+1),c&&(d+=" line-HyperMD-list-line line-HyperMD-list-line-"+s),u&&(d+=" hmd-list-indent-corrupted"),++t.extra>=s&&(t.inside=null,t.extra=null),t.combineTokens=!0,d}var p=t.atBeginning;switch(p&&/\S/.test(e.peek())&&(t.atBeginning=!1),t.combineTokens=!0,t.inside){case 4:t.combineTokens=!1;d="";return e.match(/^(?:\:\s*)?-+(?:\s*\:)?/)?d+="hmd-table-title-dash line-HyperMD-table-row line-HyperMD-table-rowsep ":e.eat("|")?(0===t.tableCol&&(d+="line-HyperMD-table_"+t.table+" ",d+="line-HyperMD-table-row line-HyperMD-table-row-"+t.tableRow+" "),d+="hmd-table-sep hmd-table-sep-"+t.tableCol,t.tableCol++):e.eatWhile(/^[^\|\-\:]+/)||e.next(),d}if(e.match(/^`[^`]*`?/))return null;if((n=e.match(/^\${1,2}/))&&("$$"===n[0]||/[^\\]\$/.test(e.string.substr(i+1))))return t.inside=1,t.extra=n[0],t.combineTokens=!1,"formatting formatting-math formatting-math-begin math math-"+t.extra.length;if(0===t.nstyle&&!t.listSpaceStack.length&&!t.inside&&e.eat("|")){d="";if(!t.table){if(!/^\s*\|/.test(e.string)&&!L.test(e.lookAhead(1)))return null;t.table="T"+e.lineOracle.line,t.tableRow=0,d+="line-HyperMD-table-title ",L.test(e.lookAhead(1))&&(d+="line-HyperMD-table-title-has_rowsep ")}return 0===t.tableCol&&(d+="line-HyperMD-table_"+t.table+" ",d+="line-HyperMD-table-row line-HyperMD-table-row-"+t.tableRow+" "),d+="hmd-table-sep hmd-table-sep-"+t.tableCol+" ",t.tableCol++,d}for(var m=t.nstyle,v=65280&m,g=(d="",0),b=_;g<b.length;g+=1){var y=b[g];m&y&&(d+=C[y]||"")}v&&(d+=C[v]||"");var k=null;if(0===v){if(e.match(/^\[((?:[^\]\\\`]|\\.|\`[^\`]*\`)+)\]/,!1)?(e.next(),k=p&&e.match(/^(?:[^\]]+)\]\:/,!1)?1792:e.match(/^(?:[^\]]+)\](?:[^\[\(]|$)/,!1)?"^"===e.peek()?1536:1024:256):(n=e.match(/^\<([^\>]+)\>/,!1))&&(T.test(n[1])||S.test(n[1]))&&(e.next(),d+="formatting formatting-url ",k=2304),null!==k)return t.nstyle|=k,d+=C[k]}else{switch(v){case 1536:k=1280,e.next();break;case 1280:case 1024:e.eat("]")&&(k=0);break;case 1792:if(e.match("]:")){k=0;var x=e.match(/^\s*(\S+)/,!1);x&&(T.test(x[1])||S.test(x[1]))&&(k=2048)}break;case 2048:e.match(/^\s*\S+/)||e.next(),k=0;break;case 256:e.eat("]")&&(k="["===e.peek()?768:512);break;case 512:case 768:var w=768===v?"]":")";if(e.match(/^"(?:[^"\\]|\\.)*"/))return d;if(!e.eat(w))return e.match(/^[^\]\)\\]+|^\\./)||e.next(),d;k=0;break;case 2304:if(!e.eat(">"))return e.match(T)||e.match(S)||e.next(),d;d+="formatting formatting-url ",k=0}if(null!==k)return t.nstyle=-65281&t.nstyle|k,d}if(8&m)return e.next(),t.nstyle-=8,d;if(e.match(/^\\(?=.)/))return t.nstyle|=8,d+=C[8],d+="hmd-escape-backslash ";if(0!=(255&t.nstyle)||!/\w/.test(e.string.charAt(e.pos-1))){if(e.match("**"))return t.nstyle^=4,d;if(e.match("__"))return t.nstyle^=4,d;if(e.eat("*"))return t.nstyle^=2,d;if(e.eat("_"))return t.nstyle^=2,d;if(e.match("~~"))return t.nstyle^=1,d}return e.match(T)?d+="url ":e.match(H)||e.next(),0!==d.length?d:null}},i={name:"markdown",highlightFormatting:!0,taskLists:!0,strikethrough:!0,emoji:!0,tokenTypeOverrides:{hr:"line-HyperMD-hr hr",list1:"list-1",list2:"list-2",list3:"list-3",code:"inline-code",gitHubSpice:!1}};for(var r in t)i[r]=t[r];return i.name="markdown",s.overlayMode(s.getMode(e,i),n)},"markdown"),s.defineMIME("text/x-hypermd","hypermd");function p(e,t,n,i){var r=new XMLHttpRequest,o=new FormData;for(var a in t)o.append(a,t[a]);r.onreadystatechange=function(){if(4==this.readyState){var e=r.responseText;try{e=JSON.parse(r.responseText)}catch(e){}/^20\d/.test(r.status+"")?n(e,null):n(null,e)}},r.open(i||"POST",e,!0),r.send(o)}var m=function(e,r){var o=0,t=document.createElement("div");t.className="HyperMD-insertFile-dfh-placeholder",r.setPlaceholder(t);for(var a=[],l="undefined"!=typeof URL,n=0;n<e.length;n++){var i=e[n];if(/image\//.test(i.type)){var s=l?URL.createObjectURL(i):"",c=i.name.match(/[^\\\/]+\.\w+$/)[0],d=document.createElement("img");d.onload=r.resize,d.className="HyperMD-insertFile-dfh-uploading",d.src=s,t.appendChild(d),a.push({blobURL:s,name:c,url:null,placeholder:d}),o++,f(i,a.length-1)}}return 0<o;function f(e,i){p("https://sm.ms/api/upload",{smfile:e,format:"json"},function(e,t){var n=e&&"success"==e.code?e.data.url:null;!function(e,t){a[e].url=t;var n=a[e].placeholder;if(n.className="HyperMD-insertFile-dfh-uploaded",n.src=t||"",l&&URL.revokeObjectURL(a[e].blobURL),0==--o){var i=a.map(function(e){return"!["+e.name+"]("+e.url+")"});r.finish(i.join(" ")+" ")}}(i,n)})}},v={byDrop:!0,byPaste:!0,fileHandler:m},g=function(e){var o=this;this.byPaste=v.byPaste,this.byDrop=v.byDrop,this.fileHandler=v.fileHandler,this.pasteHandle=function(e,t){o.doInsert(t.clipboardData||window.clipboardData)&&t.preventDefault()},this.dropHandle=function(t,n){var i=o,r=(t=o.cm,!1);t.operation(function(){var e=t.coordsChar({left:n.clientX,top:n.clientY});t.setCursor(e),r=i.doInsert(n.dataTransfer)}),r&&n.preventDefault()},this.ff_paste=new c(function(){return o.cm.on("paste",o.pasteHandle)},function(){return o.cm.off("paste",o.pasteHandle)}),this.ff_drop=new c(function(){return o.cm.on("drop",o.pasteHandle)},function(){return o.cm.off("drop",o.pasteHandle)}),this.cm=e};g.prototype.doInsert=function(e){var a=this.cm;if(!e||!e.files||0===e.files.length)return!1;var l=e.files,s="function"==typeof this.fileHandler?[this.fileHandler]:this.fileHandler,c=!1;return a.operation(function(){a.replaceSelection(".");for(var e=a.getCursor(),t={line:e.line,ch:e.ch-1},n=document.createElement("span"),o=a.markText(t,e,{replacedWith:n,clearOnEnter:!1,handleMouseEvents:!1}),i={marker:o,cm:a,finish:function(i,r){return a.operation(function(){var e=o.find(),t=e.from,n=e.to;a.replaceRange(i,t,n),o.clear(),"number"==typeof r&&a.setCursor({line:t.line,ch:t.ch+r})})},setPlaceholder:function(e){0<n.childNodes.length&&n.removeChild(n.firstChild),n.appendChild(e),o.changed()},resize:function(){o.changed()}},r=0;r<s.length;r++){if((0,s[r])(l,i)){c=!0;break}}c||o.clear()}),c};var b=l("insertFile",g);s.defineOption("hmdInsertFile",!1,function(e,t){var n=!!t;if(n&&!0!==t){if("function"==typeof t||t instanceof Array)t={byDrop:n,byPaste:n,fileHandler:t};else if("object"!=typeof t)throw new Error("[HyperMD] wrong hmdInsertFile option value")}else t={byDrop:n,byPaste:n};var i=f(t,v),r=b(e);for(var o in r.ff_paste.setBool(i.byPaste),r.ff_drop.setBool(i.byDrop),v)r[o]=i[o]});var k=Object.freeze({ajaxUpload:p,DefaultFileHandler:m,InsertFile:g,defaultOption:v,getAddon:b}),x=function(e){var t=this;this.cm=e,this.cache={},e.on("changes",r(function(){return t.rescan()},500)),this.rescan()};x.prototype.read=function(e,t){var n,i=this.cache[e.trim().toLowerCase()]||[];"number"!=typeof t&&(t=1e9);for(var r=0;r<i.length&&!((n=i[r]).line>t);r++);return n},x.prototype.rescan=function(){var e=this.cm,o=this.cache={};e.eachLine(function(e){var t=e.text,n=/^(?:>\s+)*>?\s{0,3}\[([^\]]+)\]:\s*(.+)$/.exec(t);if(n){var i=n[1].trim().toLowerCase(),r=n[2];o[i]||(o[i]=[]),o[i].push({line:e.lineNo(),content:r})}})};var E=l("readLink",x);function R(e){var t=e=e.trim(),n="",i=e.match(/^(\S+)\s+("(?:[^"\\]+|\\.)+"|[^"\s].*)/);return i&&(t=i[1],'"'===(n=i[2]).charAt(0)&&(n=n.substr(1,n.length-2).replace(/\\"/g,'"'))),{url:t,title:n}}s.defineExtension("hmdReadLink",function(e,t){return E(this).read(e,t)}),s.defineExtension("hmdSplitLink",R);var O=Object.freeze({ReadLink:x,getAddon:E,splitLink:R});function A(e){return"function"==typeof i?i(e):"<pre>"+e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/  /g," &nbsp;")+"</pre>"}var N={enabled:!1,xOffset:10};s.defineOption("hmdHover",!1,function(e,t){var n=!!t;n&&"boolean"!=typeof t||(t={enabled:n});var i=f(t,N),r=P(e);for(var o in r.ff_enable.setBool(i.enabled),N)r[o]=i[o]});var F=function(e){var t=this,n=(this.cm=e).display.lineDiv;this.lineDiv=n;var i=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div");i.setAttribute("style","position:absolute;z-index:99"),i.setAttribute("class","HyperMD-hover"),i.setAttribute("cm-ignore-events","true"),r.setAttribute("class","HyperMD-hover-content"),i.appendChild(r),o.setAttribute("class","HyperMD-hover-indicator"),i.appendChild(o),this.tooltipDiv=i,this.tooltipContentDiv=r,this.tooltipIndicator=o;var a=this.mouseenter.bind(this);this.ff_enable=new c(function(){n.addEventListener("mouseenter",a,!0)},function(){n.removeEventListener("mouseenter",a,!0),t.hideInfo()})};F.prototype.mouseenter=function(e){var t,n=this.cm,i=e.target,r=i.className;if(!(i==this.tooltipDiv||i.compareDocumentPosition&&8==(8&i.compareDocumentPosition(this.tooltipDiv))))if("SPAN"===i.nodeName&&(t=r.match(/(?:^|\s)cm-(hmd-barelink|hmd-link-url-s)(?:\s|$)/))){var o=n.coordsChar({left:e.clientX,top:e.clientY}),a=null,l=y(n,o,t[1]);if(l){var s=n.getRange(l.from,l.to);(s=s.slice(1,-1))&&(a=n.hmdReadLink(s,o.line))}a?this.showInfo(A(a.content),i):this.hideInfo()}else this.hideInfo()},F.prototype.showInfo=function(e,t){var n=t.getBoundingClientRect(),i=this.lineDiv.getBoundingClientRect(),r=this.tooltipDiv,o=this.xOffset;this.tooltipContentDiv.innerHTML=e,r.style.left=n.left-i.left-o+"px",this.lineDiv.appendChild(r);var a=r.getBoundingClientRect();a.right>i.right&&(o=a.right-i.right,r.style.left=n.left-i.left-o+"px"),r.style.top=n.top-i.top-a.height+"px",this.tooltipIndicator.style.marginLeft=o+"px"},F.prototype.hideInfo=function(){this.tooltipDiv.parentElement==this.lineDiv&&this.lineDiv.removeChild(this.tooltipDiv)};var j,P=l("hover",F,N),q=Object.freeze({text2html:A,defaultOption:N,Hover:F,getAddon:P}),I=function(e,t){var n=e.text,i=e.type,r=e.url,o=e.pos;if("url"===i||"link"===i){var a=n.match(/\[[^\[\]]+\](?:\[\])?$/);a&&e.altKey?("[]"===(n=a[0]).slice(-2)&&(n=n.slice(0,-2)),i="footref"):(e.ctrlKey||e.altKey)&&r&&window.open(r,"_blank")}if("todo"===i){var l=y(t,o,"formatting-task"),s=l.from,c=l.to,d=t.getRange(s,c);d="[ ]"===d?"[x]":"[ ]",t.replaceRange(d,s,c)}if("footref"===i){var f=n.slice(1,-1),u=t.hmdReadLink(f,o.line);u&&(B(t,u.line,o),t.setCursor({line:u.line,ch:0}))}},B=(j=null,function(e,t,n){var i,r,o=function(e){if(-1==e.options.gutters.indexOf("HyperMD-goback"))return null;var t=document.createElement("div");t.className="HyperMD-goback-button",t.addEventListener("click",function(){e.setCursor(j.find()),e.clearGutter("HyperMD-goback"),j.clear(),j=null});var n=e.display.gutters.children;return n=(n=n[n.length-1]).offsetLeft+n.offsetWidth,t.style.width=n+"px",t.style.marginLeft=-n+"px",t}(e);o&&(o.innerHTML=n.line+1+"",i=e,r=n,j&&(i.clearGutter("HyperMD-goback"),j.clear()),j=i.setBookmark(r),e.setGutterMarker(t,"HyperMD-goback",o))}),z={enabled:!1,handler:null};s.defineOption("hmdClick",!1,function(e,t){var n=!!t;n&&"boolean"!=typeof t?"function"==typeof t&&(t={enabled:!0,handler:t}):t={enabled:n};var i=f(t,z),r=U(e);for(var o in r.ff_enable.setBool(i.enabled),z)r[o]=i[o]});var $,K=function(e){var b=this;this.cm=e,this._mouseUp=function(e){var t=b._cinfo;b.lineDiv.removeEventListener("mouseup",b._mouseUp,!1),5<Math.abs(e.clientX-t.clientX)||5<Math.abs(e.clientY-t.clientY)||"function"==typeof b.handler&&!1===b.handler(t,b.cm)||I(t,b.cm)},this._mouseDown=function(e){var t=e.button,n=e.clientX,i=e.clientY,r=e.ctrlKey,o=e.altKey,a=e.shiftKey,l=b.cm;if("PRE"!==e.target.tagName){var s,c,d,f,u=l.coordsChar({left:n,top:i}),h=" "+l.getTokenTypeAt(u)+" ",p=null;if(c=h.match(/\s(image|link|url)\s/)){s=y(l,u,p=c[1]);var m=/\shmd-barelink\s/.test(h);if(/^(?:image|link)$/.test(p)&&!m){var v=y(l,{line:u.line,ch:s.to.ch+1},"url");v&&(s.to=v.to)}if(c=(d=l.getRange(s.from,s.to).trim()).match(/[^\\]\]\((.+)\)$/))f=R(c[1]).url;else if((c=d.match(/[^\\]\]\[(.+)\]$/))||(c=d.match(/^\[(.+)\]\[\]$/))||(c=d.match(/^\[(.+)\](?:\:\s*)?$/))){m&&"^"===c[1].charAt(0)&&(p="footref");var g=l.hmdReadLink(c[1],u.line);f=g?R(g.content).url:null}else((c=d.match(/^\<(.+)\>$/))||(c=d.match(/^\((.+)\)$/))||(c=[null,d]))&&(f=c[1])}else h.match(/\sformatting-task\s/)&&(p="todo",(s=y(l,u,"formatting-task")).to.ch=l.getLine(u.line).length,d=l.getRange(s.from,s.to),f=null);null!==p&&(b._cinfo={type:p,text:d,url:f,pos:u,button:t,clientX:n,clientY:i,ctrlKey:r,altKey:o,shiftKey:a},b.lineDiv.addEventListener("mouseup",b._mouseUp,!1))}},this.lineDiv=e.display.lineDiv,this.ff_enable=new c(function(){b.lineDiv.addEventListener("mousedown",b._mouseDown,!1)},function(){b.lineDiv.removeEventListener("mousedown",b._mouseDown,!1)})},U=l("click",K,z),X=Object.freeze({defaultClickHandler:I,defaultOption:z,Click:K,getAddon:U}),J=($=null,function(){return $||"function"!=typeof TurndownService||($=new TurndownService({headingStyle:"atx",hr:"---",bulletListMarker:"*",codeBlockStyle:"fenced",fence:"```",emDelimiter:"*",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"collapsed"}),"undefined"!=typeof turndownPluginGfm&&$.use(turndownPluginGfm.gfm)),$}),Y=function(e){var t=J();return t?t.turndown(e):null};s.defineOption("hmdPaste",!1,function(e,t){var n=!!t;n&&"boolean"!=typeof t||(t=Y);var i=G(e);i.ff_enable.setBool(n),i.convertor=t});var W=function(e){var o=this;this.cm=e,this.convertor=Y,this.pasteHandler=function(e,t){var n=t.clipboardData||window.clipboardData,i=o.convertor;if(i&&n&&-1!=n.types.indexOf("text/html")){var r=i(n.getData("text/html"));r&&(e.operation(e.replaceSelection.bind(e,r)),t.preventDefault())}},this.ff_enable=new c(function(){e.on("paste",o.pasteHandler)},function(){e.off("paste",o.pasteHandler)})},G=l("paste",W),Q=Object.freeze({defaultConvertor:Y,Paste:W,getAddon:G}),V={image:function(e,t){var n=e.cm,i=/\bformatting-link-string\b/;if(/\bimage-marker\b/.test(t.type)&&"!"===t.string){var r=e.lineNo,o=e.findNext(i),a=e.findNext(i,o.i_token+1),l={line:r,ch:t.start},s={line:r,ch:a.token.end},c=e.requestRange(l,s);if(c===ee.OK){var d,f,u=n.getRange({line:r,ch:o.token.start+1},{line:r,ch:a.token.start});if("]"===a.token.string){var h=n.hmdReadLink(u,r);if(!h)return null;u=h.content}d=R(u).url,f=n.getRange({line:r,ch:l.ch+2},{line:r,ch:o.token.start-1});var p=document.createElement("img"),m=n.markText(l,s,{collapsed:!0,replacedWith:p});return p.addEventListener("load",function(){p.classList.remove("hmd-image-loading"),m.changed()},!1),p.addEventListener("error",function(){p.classList.remove("hmd-image-loading"),p.classList.add("hmd-image-error"),m.changed()},!1),p.addEventListener("click",function(){return Z(n,m)},!1),p.className="hmd-image hmd-image-loading",p.src=d,p.title=f,m}}return null},link:function(e,t){var n=e.cm,i=/\bformatting-link-string\b/;if("("===t.string&&i.test(t.type)&&(0===e.i_token||!/\bimage/.test(e.lineTokens[e.i_token-1].type))){var r=e.lineNo,o=e.findNext(function(e){return i.test(e.type)&&")"===e.string}),a={line:r,ch:t.start},l={line:r,ch:o.token.end},s=e.requestRange(a,l);if(s===ee.OK){var c=n.getRange(a,l),d=R(c.substr(1,c.length-2)),f=d.url,u=d.title,h=document.createElement("span");h.setAttribute("class","hmd-link-icon"),h.setAttribute("title",f+"\n"+u),h.setAttribute("data-url",f);var p=n.markText(a,l,{collapsed:!0,replacedWith:h});return h.addEventListener("click",function(){return Z(n,p)},!1),p}}return null}};function Z(t,n,i){t.operation(function(){var e=n.find().from;e={line:e.line,ch:e.ch+~~i},t.setCursor(e),t.focus(),n.clear()})}var ee,te,ne={image:!1,link:!1,customFolders:{}};s.defineOption("hmdFold",!1,function(e,t){var n=!!t;if(!n||"boolean"==typeof t)for(var i in t={},V)t[i]=n;f(t,ne);var r=re(e);for(var o in V)r.setBuiltinStatus(o,t[o]);"object"!=typeof t.customFolders&&(t.customFolders={});var a=[];for(var l in t.customFolders)t.customFolders.hasOwnProperty(l)&&(a.push(l),l in r.folded||(r.folded[l]=[]));r.customFolderTypes=a,r.startFold()}),(te=ee||(ee={})).OK="ok",te.CURSOR_INSIDE="ci",te.HAS_MARKERS="hm";var ie=function(e){var n=this;this.cm=e,this.ff_builtin={},this.folded={},this.startFold=r(this.startFoldImmediately.bind(this),100),this._quickFoldHint=[],e.on("changes",function(e,t){t.reduce(function(e,t){return Math.min(e,t.from.line)},e.lastLine());n.startFold()}),e.on("cursorActivity",function(e){n.startQuickFold()})};ie.prototype.setBuiltinStatus=function(e,t){if(e in V){var n=this.ff_builtin[e];n||(n=new c(this.startFold,this.clear.bind(this,e)),this.ff_builtin[e]=n),n.setBool(t)}},ie.prototype.findNext=function(n,e,i){var r=this.lineNo,o=this.lineTokens,a=null,l=this.i_token+1,t=!1;if(!0===e?t=!0:"number"==typeof e&&(l=e),i)if(i.line>r)l=o.length;else if(i.line<r);else for(;l<o.length&&!(o[l].start>=i.ch);l++);for(;l<o.length;l++){var s=o[l];if("function"==typeof n?n(s):n.test(s.type)){a=s;break}}if(!a&&t){var c=this.cm,d=Math.max(i?i.line:0,r+1);c.eachLine(d,c.lastLine()+1,function(e){if(r=e.lineNo(),o=c.getLineTokens(r),l=0,i&&r===i.line)for(;l<o.length&&!(o[l].start>=i.ch);l++);for(;l<o.length;l++){var t=o[l];if("function"==typeof n?n(t):n.test(t.type))return a=t,!0}})}return a?{lineNo:r,token:a,i_token:l}:null},ie.prototype.setPos=function(e,t,n){void 0===t?(t=e,e=this.line):"number"==typeof e&&(e=this.cm.getLineHandle(e));var i=e===this.line,r=0;n||!i?(this.line=e,this.lineNo=e.lineNo(),this.lineTokens=this.cm.getLineTokens(this.lineNo)):(r=this.i_token,this.lineTokens[r].start>t&&(r=0));for(var o=this.lineTokens;r<o.length&&!(o[r].end>t);r++);this.i_token=r},ie.prototype.requestRange=function(e,t){var n=this.cm,i=s.cmpPos,r=n.getCursor(),o=n.findMarks(e,t),a=ee.OK;return 0!==o.length?a=ee.HAS_MARKERS:0<=i(r,e)&&i(r,t)<=0&&(a=ee.CURSOR_INSIDE),a!==ee.OK&&this._quickFoldHint.push(e.line),a},ie.prototype.startFoldImmediately=function(e,t){var y=this,n=this.cm;e=e||n.firstLine(),t=(t||n.lastLine())+1,this._quickFoldHint=[],this.setPos(e,0,!0),n.eachLine(e,t,function(e){var t=e.lineNo();if(!(t<y.lineNo)){t>y.lineNo&&y.setPos(t,0);var n=new Array(e.text.length),i=e.markedSpans;if(i)for(var r=0;r<i.length;++r)for(var o=i[r],a=null==o.from?0:o.from,l=null==o.to?n.length:o.to,s=a;s<l;s++)n[s]=!0;for(var c=y.lineTokens;y.i_token<c.length;){for(var d,f=c[y.i_token],u=null,h=!0,p=f.start;p<f.end;p++)if(n[p]){h=!1;break}if(h){for(d in y.ff_builtin)if(y.ff_builtin[d].state&&(u=V[d](y,f)))break;if(!u)for(var m=0,v=y.customFolderTypes;m<v.length&&(d=v[m],!(u=y.customFolders[d](y,f)));m+=1);}if(u){var g=u.find(),b=(g.from,g.to);if((y.folded[d]||(y.folded[d]=[])).push(u),u.on("clear",function(e,t){var n,i=y.folded[d];i&&-1!==(n=i.indexOf(u))&&i.splice(n,1),y._quickFoldHint.push(e.line)}),b.line!==t)return void y.setPos(b.line,b.ch);y.setPos(b.ch)}else y.i_token++}}})},ie.prototype.startQuickFold=function(){var e=this._quickFoldHint;if(0!==e.length){for(var t=e[0],n=t,i=0,r=e;i<r.length;i+=1){var o=r[i];o<t&&(t=o),n<o&&(n=o)}this.startFold.stop(),this.startFoldImmediately(t,n)}},ie.prototype.clear=function(e){var t=this.folded[e];if(t&&t.length){for(var n=0,i=t;n<i.length;n+=1){i[n].clear()}t.splice(0)}},ie.prototype.clearAll=function(){for(var e in this.folded){for(var t=this.folded[e],n=0,i=t;n<i.length;n+=1){i[n].clear()}t.splice(0)}};var re=l("fold",ie,ne),oe=Object.freeze({builtinFolder:V,breakMark:Z,defaultOption:ne,get RequestRangeResult(){return ee},Fold:ie,getAddon:re}),ae=function(e,t){var n=/formatting-math-begin\b/;if(!n.test(t.type))return null;var i=e.cm,r=e.lineNo,o=/math-2\b/.test(t.type),a=o?2:1;if(2==a&&1==t.string.length){0;var l=e.lineTokens[e.i_token+1];if(!l||!n.test(l.type))return null}var s,c=e.findNext(/formatting-math-end\b/,o),d={line:r,ch:t.start};if(c)s={line:c.lineNo,ch:c.token.start+a};else{if(!o)return null;var f=i.lastLine();s={line:f,ch:i.getLine(f).length}}var u={line:d.line,ch:d.ch+a},h={line:s.line,ch:s.ch-a},p=i.getRange(u,h).trim(),m=fe(i),v=e.requestRange(d,s);if(v!==ee.OK)return v===ee.CURSOR_INSIDE&&m.ff_pv.set(p),null;var g=le(i,d,s,p,a,"math-"+a);return m.ff_pv.set(null),g};function le(e,t,n,i,r,o){var a=document.createElement("span");a.setAttribute("class","hmd-fold-math "+(o||"")),a.setAttribute("title",i);var l=document.createElement("span");l.setAttribute("class","hmd-fold-math-placeholder"),l.textContent=i,a.appendChild(l);var s=e.markText(t,n,{className:"hmd-fold-math",replacedWith:a,clearOnEnter:!0});a.addEventListener("click",function(){return Z(e,s,r)},!1);var c=new(e.hmd.foldMath.renderer||("undefined"==typeof MathJax?se:ce))(a,"");return c.onChanged=function(){l&&(a.removeChild(l),l=null),s.changed()},s.on("clear",function(){c.clear()}),s.mathRenderer=c,d(function(){return!!c.isReady()&&(c.startRender(i),!0)},5,function(){s.clear()}),s}V.math=ae;var se=function(e,t){var n=this;this.container=e;var i=document.createElement("img");i.setAttribute("class","hmd-stupid-math"),i.addEventListener("load",function(){n.onChanged&&n.onChanged(n.last_expr)},!1),this.img=i,e.appendChild(i)};se.prototype.startRender=function(e){this.last_expr=e,this.img.src="https://latex.codecogs.com/gif.latex?"+encodeURIComponent(e)},se.prototype.clear=function(){this.container.removeChild(this.img)},se.prototype.isReady=function(){return!0};var ce=function(e,t){this.div=e,this.mode=t,this.onChanged=null,this.jax=null,this._cleared=!1,this._renderingExpr="";var n=document.createElement("script");n.setAttribute("type",t?"math/tex; mode="+t:"math/tex"),e.appendChild(n),this.script=n};ce.prototype.clear=function(){this.script.innerHTML="",this.jax&&this.jax.Remove(),this._cleared=!0},ce.prototype.startRender=function(e){if(!this._cleared)if(this._renderingExpr)this._renderingExpr=e;else{this._renderingExpr=e;var t=this.script;t.innerHTML=e,this.jax?MathJax.Hub.Queue(["Text",this.jax,e],["_TypesetDoneCB",this,e]):(this.jax=MathJax.Hub.getJaxFor(t),MathJax.Hub.Queue(["Typeset",MathJax.Hub,t],["_TypesetDoneCB",this,e]))}},ce.prototype._TypesetDoneCB=function(e){if(!this._cleared){if(this._renderingExpr!==e){var t=this._renderingExpr;return this._renderingExpr="",void this.startRender(t)}this._renderingExpr="","function"==typeof this.onChanged&&this.onChanged(e)}},ce.prototype.isReady=function(){return"object"==typeof MathJax&&MathJax.isReady};var de={renderer:null,onPreview:null,onPreviewEnd:null};s.defineOption("hmdFoldMath",de,function(e,t){var n=de;"object"==typeof t?n=f(t,de):console.warn("[HyperMD FoldMath] wrong option format. If you want to stop folding math. set options.hmdFold.math = false");var i=fe(e);for(var r in n)i[r]=n[r]});var fe=l("foldMath",function(e){var t=this;this.cm=e,this.ff_pv=new c(function(e){t.onPreview&&t.onPreview(e)},function(){t.onPreviewEnd&&t.onPreviewEnd()},null)},de),ue=Object.freeze({MathFolder:ae,insertMathMark:le,StupidRenderer:se,MathJaxRenderer:ce,defaultOption:de,getAddon:fe}),he={enabled:!1};s.defineOption("hmdTableAlign",he,function(e,t){var n=!!t;n&&"boolean"!=typeof t||(t={enabled:n});var i=f(t,he),r=me(e);for(var o in r.ff_enable.setBool(i.enabled),he)r[o]=i[o]});var pe=function(e){var f=this;this.cm=e,this.styleEl=document.createElement("style"),this.updateStyle=r(function(){if(f.enabled){var e=f.cm,t=f.measure(),n=f.makeCSS(t);n!==f._lastCSS&&(f.styleEl.textContent=f._lastCSS=n,setTimeout(function(){return u(e)},50))}},100),this._procLine=function(e,t,n){if(n.querySelector(".cm-hmd-table-sep")){for(var i=n.firstElementChild,r=Array.prototype.slice.call(i.childNodes,0),o=0,a=f.makeColumn(o),l=a.firstElementChild,s=0,c=r;s<c.length;s+=1){var d=c[s];d.nodeType===Node.ELEMENT_NODE&&/cm-hmd-table-sep/.test(d.className)?(o++,a.appendChild(l),i.appendChild(a),i.appendChild(d),l=(a=f.makeColumn(o)).firstElementChild):l.appendChild(d)}a.appendChild(l),i.appendChild(a)}},this.ff_enable=new c(function(){e.on("renderLine",f._procLine),e.on("update",f.updateStyle),e.refresh(),document.head.appendChild(f.styleEl)},function(){e.off("renderLine",f._procLine),e.off("update",f.updateStyle),document.head.removeChild(f.styleEl)})};pe.prototype.makeColumn=function(e){var t=document.createElement("span");t.className="hmd-table-column hmd-table-column-"+e,t.setAttribute("data-column",""+e);var n=document.createElement("span");return n.className="hmd-table-column-content",n.setAttribute("data-column",""+e),t.appendChild(n),t},pe.prototype.measure=function(){for(var e=this.cm.display.lineDiv.querySelectorAll(".hmd-table-column-content"),t={},n=0;n<e.length;n++){var i=e[n],r=i.parentElement,o=r.parentElement.parentElement.className.match(/HyperMD-table_(\S+)/)[1],a=~~r.getAttribute("data-column"),l=i.offsetWidth+1;o in t||(t[o]=[]);for(var s=t[o];s.length<=a;)s.push(0);s[a]<l&&(s[a]=l)}return t},pe.prototype.makeCSS=function(e){var t=[];for(var n in e)for(var i=e[n],r="pre.HyperMD-table-row.HyperMD-table_"+n+" .hmd-table-column-",o=0;o<i.length;o++){var a=i[o];t.push(""+r+o+" { min-width: "+a+"px }")}return t.join("\n")};var me=l("tableAlign",pe,he),ve=Object.freeze({defaultOption:he,TableAlign:pe,getAddon:me});s.defineOption("hmdLoadModeFrom",!1,function(e,t){var n=!!t,i=be(e);i.ff_enable.setBool(n),i.source=t});var ge=function(e){var l=this;this.cm=e,this.source="./node_modules/codemirror/",this._loadingModes={},this.rlHandler=function(e,t){var n=t.lineNo(),i=(t.text||"").match(/^```\s*(\S+)/);if(i){var r=i[1],o=s.findModeByName(r),a=o&&o.mode;!a||a in s.modes||l.startLoadMode(a,n)}},this.ff_enable=new c(function(){e.on("renderLine",l.rlHandler)},function(){e.off("renderLine",l.rlHandler)})};ge.prototype.touchLine=function(e){var t=this.cm.getLineHandle(e),n=t.text.length;this.cm.replaceRange(t.text.charAt(n-1),{line:e,ch:n-1},{line:e,ch:n})},ge.prototype.startLoadMode=function(e,t){var n=this._loadingModes,i=this;if(0<=t&&e in n)n[e].push(t);else{0<=t&&(n[e]=[t]);var r=function(){console.log("[HyperMD] mode-loader loaded "+e);var t=n[e];i.cm.operation(function(){for(var e=0;e<t.length;e++)i.touchLine(t[e])}),delete n[e]},o=this.source+"mode/"+e+"/"+e+".js";if("function"==typeof requirejs&&"~"===o.charAt(0))requirejs([o.slice(1,-3)],r);else{var a=document.createElement("script");a.onload=r,a.onerror=function(){console.warn("[HyperMD] mode-loader failed to load mode "+e+" from ",o),-1!==t&&(console.log("[HyperMD] mode-loader will retry loading "+e),setTimeout(function(){i.startLoadMode(e,0<=t?-3:t+1)},1e3))},a.src=o,document.head.appendChild(a)}}};var be=l("modeLoader",ge),ye=Object.freeze({ModeLoader:ge,getAddon:be}),ke={enabled:!1,line:!0,tokenTypes:"em|strong|strikethrough|code|link|task".split("|")};s.defineOption("hmdHideToken",ke,function(e,t){var n=!!t;n&&"boolean"!=typeof t?"string"==typeof t?t={enabled:!0,tokenTypes:t.split("|")}:t instanceof Array&&(t={enabled:!0,tokenTypes:t}):t={enabled:n};var i=f(t,ke),r=He(e);for(var o in r.ff_enable.setBool(i.enabled),ke)r[o]=i[o]});var xe="hmd-hidden-token",we="hmd-inactive-line",De=function(e){var i=this;this.cm=e,this.shownTokensStart={},this.renderLineHandler=function(e,t,n){i.procLine(t,n)},this.cursorActivityHandler=function(e){i.update()},this.update=r(function(){return i.updateImmediately()},100),this.ff_enable=new c(function(){e.on("cursorActivity",i.cursorActivityHandler),e.on("renderLine",i.renderLineHandler),e.on("update",i.update),i.update()},function(){e.off("cursorActivity",i.cursorActivityHandler),e.off("renderLine",i.renderLineHandler),e.off("update",i.update),i.update.stop(),e.refresh()})};De.prototype.calcShownTokenStart=function(){var e=this.cm,t=e.getCursor(),n=this.tokenTypes,i=new RegExp("\\sformatting-("+n.join("|")+")\\s"),r={},o=e.getLineTokens(t.line),a=-1,l=[],s=null,c=[];for(var d=0;d<o.length;d++){var f=o[d];-1===a&&(f.end>t.ch||d===o.length-1)&&(a=d);var u=f.type&&f.type.match(i);if(u){var h=u[1];if(h!==s){var p=l[l.length-1];if(p&&p[1]===h){if(l.pop(),-1!==a||f.end===t.ch){c.push(p[0],f);break}}else if(l.push([f,h]),-1!==a){c.push(f);var m=new RegExp("\\sformatting-"+h+"\\s");for(d+=1;d<o.length;d++){var v=o[d];if(v.type&&m.test(v.type)){c.push(v);break}}break}0,s=h}}else{if(-1!==a){if(0<l.length){var g=l.pop(),b=g[0],y=g[1],k=new RegExp("\\sformatting-"+y+"\\s");for(c.push(b),d+=1;d<o.length;d++){var x=o[d];if(x.type&&k.test(x.type)){c.push(x);break}}}break}s=null}if(-1!==a&&0===l.length)break}for(var w=r[t.line]=[],D=0,H=c;D<H.length;D+=1){var M=H[D];w.push(M.start)}return r},De.prototype.procLine=function(e,t){if(!e)return-1;var n=this.cm,i=e.lineNo(),r=w(n,i);if(!r||r.hidden||!r.measure)return-1;for(var o=D(r,e,i).map,a=o.length/3,l=(i in this.shownTokensStart?this.shownTokensStart[i].sort(function(e,t){return e-t}):null),s=-1,c=0,d=0;c<a;c++,d+=3){var f=o[d],u=(o[d+1],o[d+2]),h=u.parentElement;if(u.nodeType===Node.TEXT_NODE&&h&&/^span$/i.test(h.nodeName))for(var p=h.className,m=0,v=this.tokenTypes;m<v.length;m+=1){var g=v[m];if(("link"!==g||!/cm-hmd-footref|cm-hmd-footnote|cm-hmd-barelink/.test(p))&&-1!==p.indexOf("cm-formatting-"+g+" ")){var b=!0;if(l&&0<l.length){for(;l[0]<f;)l.shift();b=l[0]!==f}b?-1===p.indexOf(xe)&&(h.className+=" "+xe,-1===s&&(s=f)):-1!==p.indexOf(xe)&&(h.className=p.replace(xe,""),-1===s&&(s=f));break}}}if(this.line&&(t=t||r.text)){var y=t.className,k=-1===y.indexOf(we),x=null!==l;k!=x&&(t.className=x?y.replace(we,""):y+" "+we,s=0)}return-1!==s&&r.measure.cache&&(r.measure.cache={}),s},De.prototype.updateImmediately=function(){var r=this,o=this.cm,a=o.getCursor(),e=this.shownTokensStart,t=this.shownTokensStart=this.enabled?this.calcShownTokenStart():{},l=!1,s=[];for(var n in e)s.push(~~n);for(var i in t)s.push(~~i);s=s.sort(function(e,t){return e-t}),o.operation(function(){for(var e=-1,t=0,n=s;t<n.length;t+=1){var i=n[t];if(i!==e)e=i,-1!==r.procLine(o.getLineHandle(i))&&a.line===i&&(l=!0)}l&&(u(o,!0),o.hmd.tableAlign&&o.hmd.tableAlign.enabled&&o.hmd.tableAlign.updateStyle())})};var He=l("hideToken",De,ke),Me=Object.freeze({defaultOption:ke,HideToken:De,getAddon:He});s.defineOption("hmdCursorDebounce",!1,function(e,t){var n=!!t;Te(e).ff_enable.setBool(n)});var Le=function(e){var i=this;this.cm=e,this.mouseDownHandler=function(e,t){i.lastX=t.clientX,i.lastY=t.clientY;var n=i.mouseMoveSuppress;document.addEventListener("mousemove",n,!0),i.lastTimeout&&clearTimeout(i.lastTimeout),i.lastTimeout=setTimeout(function(){document.removeEventListener("mousemove",n,!0),i.lastTimeout=null},100)},this.mouseMoveSuppress=function(e){Math.abs(e.clientX-i.lastX)<=5&&Math.abs(e.clientY-i.lastY)<=5&&e.stopPropagation()},this.ff_enable=new c(function(){e.on("mousedown",i.mouseDownHandler)},function(){e.off("mousedown",i.mouseDownHandler)})},Te=l("cursorDebounce",Le),Se=Object.freeze({CursorDebounce:Le,getAddon:Te});e.InsertFile=k,e.ReadLink=O,e.Hover=q,e.Click=X,e.Paste=Q,e.Fold=oe,e.FoldMath=ue,e.TableAlign=ve,e.ModeLoader=ye,e.HideToken=Me,e.CursorDebounce=Se,e.Addon=h,e.FlipFlop=c,e.tryToRun=d,e.debounce=r,e.fromTextArea=function(e,t){var n={lineNumbers:!0,lineWrapping:!0,theme:"hypermd-light",mode:"text/x-hypermd",tabSize:4,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","HyperMD-goback"],extraKeys:{Enter:"newlineAndIndentContinueMarkdownList"},hmdInsertFile:{byDrop:!0,byPaste:!0},hmdCursorDebounce:!0,hmdHover:!0,hmdClick:!0,hmdFold:{image:!0,link:!0,math:!0},hmdFoldMath:{},hmdPaste:!0,hmdHideToken:!0,hmdLoadModeFrom:"~codemirror/",hmdTableAlign:!0};if("object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return s.fromTextArea(e,n)},e.switchToNormal=function(e,t){e.setOption("theme",t||"default"),e.setOption("hmdFold",!1),e.setOption("hmdHideToken",!1),e.setOption("hmdTableAlign",!1)},e.switchToHyperMD=function(e,t){e.setOption("theme",t||"hypermd-light"),e.setOption("hmdFold",!0),e.setOption("hmdHideToken",!0),e.setOption("hmdTableAlign",!0)},e.cm_internal=a,e.getEveryCharToken=function(e){var t=new Array(e.text.length),n=e.styles,i=0;if(n)for(var r=1;r<n.length;r+=2)for(var o=n[r],a=n[r+1];i<o;)t[i++]=a;else for(var l=(e.parent.cm||e.parent.parent.cm||e.parent.parent.parent.cm).getLineTokens(e.lineNo()),s=0;s<l.length;s++)for(var c=l[s].end,d=l[s].type;i<c;)t[i++]=d;return t},e.expandRange=y,e.updateCursorDisplay=u,Object.defineProperty(e,"__esModule",{value:!0})});
